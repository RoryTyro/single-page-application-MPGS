<!DOCTYPE html>
<html>
  <head>
    <title>My App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="stylesheet" href="app.min.css">
    <style>
      .center-fit {
            max-width: 100%;
            max-height: 100vh;
            margin: auto;
        }
      /* TODO */
    </style>
<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>    <script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
    
  </head>

  <body>
    <div class="app-page" data-page="home">
      <div class="app-topbar">
          <div class="app-topbar">
              <div class="app-button left" data-back>Back</div>
              <div class="app-title">Single page MPGS Demo</div>
              <div class="app-button right">Forward</div>
            </div>
      </div>
      <div class="app-content">
        <div class="app-section">
          
          
        </div>
        <div class="app-section"> 
          <div class="app-content">Steak Sandwich</div>
          <div class="app-content">$15.00</div>
          <img class="center-fit" src="steak-sandwich.png " width="128" height="128" onclick="App.load('cart');"> </img>
        </div>

         
        </div>
      </div>
    </div>

    <div class="app-page" data-page="cart">
      <div class="app-topbar">
        <div class="app-button left" data-back data-autotitle></div>
        <div class="app-title">Cart</div>
      </div>
      <div class="app-content">
          <div class="app-section"> 
              <div class="app-content">Steak Sandwich</div>
              <div class="app-content" id="purchase-amount" value="15.00">$15.00</div>
              <img class="center-fit" src="steak-sandwich.png" width="128" height="128"> </img>
            </div>
            <div class="app-button red" data-clickable-class="active" style="-webkit-tap-highlight-color: rgba(255, 255, 255, 0);" onclick="App.load('payment-page');">Pay now</div>
      </div>
    </div>



    <div class="app-page" data-page="payment-page">
        <div class="app-topbar">
                <div class="app-button left" data-back>Back</div>
        </div>
        <div class="app-content">
        <div class="app-section">
          <head>
            <script src="https://kit.fontawesome.com/818d40f8ce.js" crossorigin="anonymous"></script>
            <!-- Required meta tags -->
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
              <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
              <script src="https://test-tyro.mtf.gateway.mastercard.com/form/version/58/merchant/TYRO_318/session.js"></script>
              <style>
              pre {
            white-space: pre-wrap;
          }
          
          .input-group-addon {
              background-color: transparent;
              border-left: 0;
          }
          .input-padding{
              padding-bottom: 5pt
          }
          .bottom-align-text {
              position: absolute;
              bottom: 0;
              right: 0;
            }
          
          .no-border {
              border: 0;
              box-shadow: none; 
          }
          .cc-number.identified {
              background-repeat: no-repeat;
            background-position-y: 3px;
            background-position-x: 99%;
          }
          
          .ccnumber {
              background-position: left center;
          }

          .blank-card{
            background-color: white;
              content: url(https://s.pngkit.com/png/small/5-52430_banner-cards-vector-credit-card-credit-card-icon.png);
          }
          .visa {
              background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAABHNCSVQICAgIfAhkiAAABLhJREFUWIXtmGtMFGcUhp9vdhaWBceyuCjFCwouIBhQ0agYMYKphraoMbZVY9T+0NQ/pbZpE2uTpknTJk1JWnszsdVqrVbTRpNeTDCtqRULoiAW2S1euClQdhfXZYHdYac/djtgtMVWE6Dx/TVzvnO+ed9z+WYyAsDhcCQCJZqm5WuaZmEYQwjhEkKcAIptNluLqKqqSjSbzTVxcXExiqIYZVkeao7/CFVV8Xg8AafT6fX5fNNls9lcEhcXN8pisQxv5mHIsozFYjECMUCJFAwGCxRFGRHkB0JRFGMwGCyQgNjh3jZ3Q5hzrDTURO4XDwUMNR4KGGrc9fhR/6hFddUj0EIGYcAwJh3Zkqz7+Lr9HC+9CEBUVARLCzL59vgF/H6VmOhIlizOACAY1Cgrv0xVTRNt7TcxGCTiraNY/8x8os2R+n7XGju48FszfWoQRYkiPy/9vwuQrdMwRMfT6zhG17ldEPAhRcQQu+EUiFDRDn1dwVsl3wGweeMi5s1J5oXthwBYON/GksUZ3PL2sH7Lbmrrrt/xjFVFOboAd6ePFWs/wNftByDCKFN5cgcREYMf73/rIcxjMGVv4tV9PWzOKsPSXU2f+woGS0pYQDkARtnAuqfm4qhv02OTJ1sBeOf94zr5x/IzKVg0Db9f5Vx1A6OVKN1/38EynTyAP6BSU9vCrOxJgwoYdAamZmZQtHMCbcaZqB2XADhz9gpXGzoAKFyaRfyYUTjqW/tjkscCUHWhUbctL5zBk8uyWFU0izdfW6lnt6cnwIEjZwCYN7u/Rc8PiL0vAXm5NvqCgqd3JdJwtRmAg0fK9fWNa+YDYB9QgalT4gGYmdWfwee27eelHYdpvu6+bf8jRytxd/oAeKV4mV6Zc9UND0ZAmi2BsVaFXhVKjgbocHop/akWCGUszZYAoFdACEFyWMDLzy9j9YrZCCHQNI1j31fx+Or3OP3rZSA04HsO/AJAVuYE0mwJZE+fCMD56gdUAYC83FQAfqxo59P9pwiofQBsWrdA9/n9cqgCiQmP6MNpMhl5Y/tyDu/ZQk52EgDdPX5ef/sYAD+cuEhTiwuAuTlTqHPcYGy8AoCrs4trjc4HJGCBDQBN09j75WkAkpOsLMwN2d2dXXi7egGwpYwLEw3o8dMzxvPhu+sQQgDg84UGdvfnP+s+n+w5SdGanXz1TYVuu5c2uqfP0HlzUjDKBgJqH2o4+xvW5urrN1pv6te2lNAAb9r6GQAZ6Y9ilA2UV15F00LvlcV5aZw5e4WLl1oAiImOJDLSqO/hcnehaRrnqxtZ+cTM+xcQbY4gZ0YSZRWh3rXERrO8cIa+3treLyA1XAFHfSvert47sliwaBrbtxWy9cUvdNvej58lMz1Rv1+1/iNqapuprG7A6fJiMhlve+kNhKirq9NSU1MHFdHh9OJyewFQFDPjwr0K4LnVQ2tbJwATx8dhMhlpanHT0NSB19uLpmmMHh3FlKR4Pe6voTfIBpKTrLc9q7Xdg8fjQwjB5ElWJEkgSeIOTna7/d4FDEfY7faR/zH3UMBQ438hwK2q6lDz+NcIc3ZLkiSVejyeEafA4/EEJEkqlX0+XzFQAIy4X4tAsYCR/XP3T6N8y7XxxywcAAAAAElFTkSuQmCC);
              background-position: left center;
              
          }

          .mastercard {
              background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAABHNCSVQICAgIfAhkiAAABOFJREFUWIXVmF1MU2cYx3/ncA4t/dRWPhRECU07DKhoYIuZJFomQXAsuzHZsi3Ri+GyZHGZyZxuu+BCb4xemDi3ZDeDRU0Mm86wRYmZeuEEHImT0VKCfPnBV7GlhdLS7uLoxoXA230J/+RcnPR53vf3vH3e532fIwF4vd5s4HgikXAnEgkbi1iSJI1JktQM7Hc6nYNSe3t7tsFguGO3200Wi0VVFOV5M86rWCxGIBCIjo6OToTD4SLFYDAct9vtZpvNtrjJn0hRFGw2mwqYgONyPB4vt1gsSwJ+tiwWixqPx8tlYPliT5tn6Qnzcvl5g/xT/e2lj42M4G9sJHj5MpHeXuLBIEp6OmmFhVh37sRSWYkkz1qf+AwM/AR9P4C/AyaHQDWDeQ1kvwJrX4O09KQ5pM7OzoTL5RJ2iEciPKirY+jECeKh0Jx2OqeTnGPHWFZdDb0X4eYBeOyZe2DFCIUfwObPIEUnxOLxeJILIPrwIb6aGsK3bgnZI0m4vngDEw1i9gDpJVDxPRhWLmjq8XgQ3gMzoRC+qipxeCDFomfoqwYeNQu7wHALNFVBdO5/d7aEAxg8eJDw7dvCHMaS9eS9NYn9JdBnQiIu7Aqjv8Ktj4VMhVIo0tPDb04nxGLCDKkZOlRj5M93XQbk7RF2B0mB3V6w5M1p4vF4xKrQ2JkzyHo9OoeDKY+H1NxcmJkh4vM9G35tLo53+p49WKoVbBtg/HeYGp570uUF0H0Gig/OyyYUQPDqVZbV1JBXX493xw4cFy4w3tiI//x5FJuNsbNnSSsoIK24GOJxrNXVdL//NtZdrzPZ3kZ8IoiavZoMdwrm2gYIdMO9Rgg/AFmnldYVm2CiX1vxmWnYehquv/vvBBAdGMDidjPd349t925iw8NMeb3onU5MZWWYt23DWl3Ng7o6dA4Hkiyz+lQDU11dZHz0KWP19azYu5eZ/lboqodfDoB+Bbj2wJoaWLMLVlfA/Z/BmK1N6r8LoYEF2YQ3cVphIaHWVsxuNxGfjxSTCWtVFXqXi6muLibv3sVYUoIuP5+hkycxl5dj2LCB6P376NetY/DwYe0wG2nTBszaqoGb14IpF7rPgmKAts+hv0kLQEBCAag5OaQVFRFuayPQ1IQuP58Uu53Y6Kj2e2YmweZmDKWlqKtWYdi4kemeHkKtrfjPnUNfUEC4pYVY549QegS2fgk5FTDRBymp2jPcoqVW0Yfwwl7ttDbmLMgmlEKW7dvpra1lqqODRCzG46YmJm7cwLRlC7HxcSRZRl25Em9ZGUpmJgATTV9jfNlNtKeL4aM+CHaiDt6B6/dAVmCoRcv7jtPau78DfN9C5hbtDBjv0IJZQP9ZGc19z4Fe/1eVUq2gzxJ2Fy6jQimky8sjfd++JGaHvlPdPLoMj65oT2wiKXdYVzsv/FMJb+LsI0cwbNokDpBIoOZvxroect8Ek0PcFXsxlB4VMhUOIMVoxHHpEobSUmGOke/aiPAiqcuEXbTLXOUlUI1C5kk1NGpWFq5r18g6dAjZOP8EOqeT/IsXyfnmJlRcAOsCN17FCBs/gVevC91EnyrpfuCpZjc00319zAQC/3tDk3Q/sNiUVD+wWCUD/lgS9X2x6AmzX5Zl+UogEFhyEQQCgagsy1eUcDi8HygHltynRWC/BEv74+4fAxroUkHf2nEAAAAASUVORK5CYII=);
              background-position: left center;
          }
          .amex {
              background-image: url(data:image/png;base64,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);
              background-position: left center;
          }
          .discover {
              background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAeCAYAAABqpJ3BAAAABHNCSVQICAgIfAhkiAAABMNJREFUWIXVWF1oU2cYfnJ6WrTYbE2oBEpko9JQaosQsChjggqhiobdWC+qd2V/udCOXUmkdlUYvciuKsxhV3B0qx1tJrgJrZqua1eKmmKWpkbr2lg12BobNSfJ+c55djEX7FrFn2KTB76L877v937PA8/Hd3gNAHD9+vVSAB6S20makMUwGAwPDAZDP4BD5eXlMwa/319aWFh4zWw2rzEajfmyLK80xxdCCIF4PK7Ozc09TiQSVXJhYaHHbDYXmUym7Gb+FLIsw2Qy5QNYA8Aj6bq+w2g05gT5Z2E0GvN1Xd8hASjOdtsshaeci6WVJvKmyHkBi7xz9OhRRCIRrFq1Cna7Hfv374csy3C73XC5XFAUBS0tLYhGo6ivr0ddXR1mZ2fR2tqKYDCIyspKHD58GEVFRdBu/QF1+FsgEYNU9iHyP3Dh+9OdMJlMcDqdAIBTp05h3bp1GBgYwJ07dwAAJSUlOH78OBoaGgAAxcXFOHDgAKqqqhYrCIVCfBbV1dU8efIke3t76XQ6uWfPHpKkzWbjxMQEHQ4HW1tbOTw8zNHRUSqKQpvNxubmZgYCAXo8HobDYYrpUT5pfp9Pmt/LrOSZz3j27Flu3LiRJJlOp2mxWDg9Pc2Kigq2t7ezv7+fQ0NDFEJQkiSOjIywvb2dFouF/0coFOKSt3fTpk2orq7Grl27YLFYEIlEMrnS0lJ4vV6sX78eu3fvRl9fH8xmM9xuNwCgsrISAJD65UsAXNBXGz+H2sYWfP7gAcbGxnDjxg1s3rwZVqsVADA5OYlEIgGr1QqDwQAAiEQimJ6eRklJyctZaEFSllFQUABVVTOxEydOoKurC8eOHYPX64XT6cTq1asXb5byluwp5eWhoaEBHR0dmJiYQGNjYyaXTCahKApSqRQAgCR8Ph86OzsRCoWWJrmUhS5evMhgMEiXy8WtW7cusJDP52MsFmNPTw/tdjvn5uZosVjY3d1NIQS7u7sZCAQoZvx88lXZQgv1HCJJ3r17l2vXruWGDRsy51ZUVHBwcJDRaJTRaJRCCObl5ZEkHQ4H29ralrTQIgH19fWsqanhtm3b2NTUxPn5eZLk3r17OTU1xSNHjrC8vJx2u52XLl0iSfr9fu7cuZNlZWWsra1lOBwmSYrIFSbPfEqlo47pwTbqIpU55+DBg+zo6Mh879u3jzU1NZmlqiq3bNlCkgwEAnQ4HFQUJVOvhs4vLSAXIG4NMdG2naFQiDn3DujRcaTOfALoGoAce8j0e0EkT9cDyXgmljM/Qdrfw0h1fQykHi2I54QA9fIPUH9rAnSxKJfVAph6jPSvbmjXep9bk7UCtKkRpL1fgPMzL6zLOgFMxJC+8DW0qz+9VH3WCKCWhrjSCdX3DaA8fOl9Ky6AugYt4IXq84APb7/y/hUTQFWB8HdB/PndaxH/D29dgD57E+LqjxBj3a9klefhrQig8hBa6DzE2M/QI6PL01T6l7oMICaEWPbJBB/fhxa+ABE8B/3WHwC1Ze2Pd60AEJMlSeqLx+Mfvelgi2oS+u3L0G4OQJv8HYyOLw/R5yBlcwpJkvpee7RITYV+7y/ot69An7kKPToOaIuf+mWFXAC8Y0XK5hT3iyoeAagyALk93P0HjHXGXp92US0AAAAASUVORK5CYII=);
              background-position: left center;
          }
              </style>
            </head>
          
          <body>
            <div onload="initialisePayment();" ></div>
            <div id="container" class="mx-auto p-3"></div>
          <span  class="p-0"> </span>
            <div class="card mx-auto">
           
      
              <div class="card-body">
              
                  <div class="form-row">
                    <div class="form-group col-md-4">
                      <label for="nameoncard">Name on Card</label>
                      <input class="form-control inputs shadow-sm" type="text" id="nameoncard" autocomplete="cc-name" value="" readonly>
                    </div>
                  </div>
          
                  <div class="form-row ">
                    <div class="form-group col-md-4">
                      <label for="ccnumber">Card Number</label>
                      <div class="input-group form-control shadow-sm " id="ccnumber-border">
                        <div class="input-group-prepend">
                          <span id="card-type" style="height: 30px; width: 49px;" class="blank-card"></span>
                        </div>
                      <input class="no-border ccnumber" style="height: 30px; width: 200px;" type="tel" id="ccnumber" autocomplete="cc-number" maxlength="4" readonly>
                    </div>
                  </div>
                  </div>
                  
                  <div class="form-row ">
                  <label for="cc-exp-month" class="col-md-2" id="">Expiry</label>
                  <label for="cvv2" class="col-md-2">CVV</label>
                </div>
                  <div class="form-row ">
                  

               

                    <div class="form-group col-md-2">
                    <div class=" input-group form-control shadow-sm ">

                    <input class=" no-border" style="height: 25px; width: 50px;" type="tel" id="ccExpMonth" autocomplete="cc-exp-month" readonly>
                    <span class="align-top pb-1" id="">/</span>
                    <input class=" no-border " style="height: 25px; width: 50px;" type="tel" id="ccExpYear" autocomplete="cc-exp-year" readonly>
                  </div>
                  </div>
                
            
                
                    <div class="form-group col-md-2">
                      <div class="input-group-prepend">
                      
                    </div>
                      <input class="form-control shadow-sm" type="text" id="cvv2"  autocomplete="off" readonly>
                      </div>
           
                    </div>

  

                    <div class="form-row">
                  <button id="payment-button" onclick="updateSession()" class="btn btn-primary col-md-4 shadow-sm" disabled>Pay</button>
                </div>
              </div>
              <div class="card-footer text-muted">
                Powered by 
                <img class="card-img" src="https://2n18ua1tyz6r3kfqtckmdy45-wpengine.netdna-ssl.com/wp-content/uploads/2019/07/TYRO_Logo_POS_RGB-2.png" alt="Card image cap" style="width: 50px;height: auto;">
                <i class="far fa-credit-card"></i>
              </div>
            </div>
          
          
          
          
        </div>
        </div>
        <div class="loader-active"></div>
        <img class="center-fit" src="https://media.giphy.com/media/F0uq8iiIL6F6E/giphy.gif"></img>
      </div>
   
    <script src="app.min.js"></script>
    <script src="https://test-tyro.mtf.gateway.mastercard.com/form/version/58/merchant/TYRO_318/session.js" type="text/javascript"></script></script>

<script>
      //<script src="//zeptojs.com/zepto.min.js">
    var scopeId = 0;
    console.log("scopeId at initilisation = " + scopeId );

      App.controller('home', function (page) {
        // put stuff here
      });

      function cartPage(page, scopeId) {
        console.log("scopeId at in cartPage = " + scopeId );
        // put stuff here
      }
      App.controller('cart', cartPage );



      App.controller('payment-page', function (page, scopeId) {


          console.log("scopeId on page load = " + scopeId);

  $(page).on('appReady', function () {
    console.log('the page is ready!');
  
  


        //MPGS code goes here

  PaymentSession.configure({
 
    fields: {
          // ATTACH HOSTED FIELDS TO YOUR PAYMENT PAGE FOR A CREDIT CARD
          //sessionId: sessions[i],
          card: {
            number: "#ccnumber",
            securityCode: "#cvv2",
            expiryMonth: "#ccExpMonth",
            expiryYear: "#ccExpYear", 
            nameOnCard: "#nameoncard"

          }
        },
        frameEmbeddingMitigation: ["x-frame-options"],
        callbacks: {
 		initialized: function(response) {
         // HANDLE INITIALIZATION RESPONSE
         console.log("configuration ran");
           console.log(response);

         },
         formSessionUpdate: function(response) {
         console.log("card-number update: " + JSON.stringify(response));
         document.getElementById("response").innerText = JSON.stringify(response);
         // HANDLE RESPONSE FOR UPDATE SESSION
         if (response.status) {
             if ("ok" == response.status) {
                 console.log("Session updated with data: " + response.session.id);
                 var sessionId = response.session.id;
           			 document.getElementById("sessionId").innerText = sessionId;

         if (response.sourceOfFunds.provided.card.number) {
         console.log("valid card was provided.");
         document.getElementById("card-invalid").setAttribute("class", "invisible");
        // configureDateAndCvv(sessionId);
         }
         if (response.sourceOfFunds.provided.card.number) {
         console.log("valid card was provided.");
         
         
        }

        } else if ("fields_in_error" == response.status)  {
                 console.log("Session update failed with field errors.");
                 if (response.errors.cardNumber) {
                 console.log("Card number invalid or missing.");
                 document.getElementById("card-invalid").setAttribute("class", "alert alert-danger visible");
                 document.getElementById("card-number").setAttribute("class", "form-control cc-number");
                  }
    } 
    }
}
},
interaction: {
        displayControl: {
            formatCard: "EMBOSSED",
            invalidFieldCharacters: "REJECT"
			 }
 		}
  },scopeId);

  PaymentSession.onValidityChange(["card.number"], function(selector, result) {
    var ccnumberDiv = document.getElementById("ccnumber-border");
    if (result.isValid) {
        //handle valid results
        console.log('The entered value is valid.');


        ccnumberDiv.classList.remove("is-invalid");
      ccnumberDiv.classList.add("valid");
        //document.getElementById("cc-exp-month").focus();
         $("input").focus();
        //get selector of the valid field
        console.log(selector);
    } else {
        //handle invalid results
        if (result.isIncomplete) {
            console.log('Field value is incomplete, please enter full value.');
        }
        if (result.hasError) {
            console.log('Error has been detected on the hosted field.');
        }
        if (result.errorReason) {
            switch (result.errorReason) {
                case 'EMPTY':
                    console.log('Field is mandatory field, please enter the value.');
                    break;
                case 'INVALID_CHARACTERS':
                    console.log('There is invalid character in the hosted field.');
                    break;
                //this event is fired on "card.number" and "giftCard.number" fields
                case 'NOT_SUPPORTED':
                    console.log('The card number you entered is not supported.');
                    break;
                case 'INVALID_VALUE':
                    console.log('The value you entered is incorrect, please check the value and try again.');
                    break;
                case 'INVALID_LENGTH':
                    console.log('The value you entered is too long.');
                    break;
                //this event is fired on "card.expiryYear" field
                case 'EXPIRED':
                    console.log('The date you entered is expired.');
                    break;
                default:
                    break;
            }
        }
        //get selector of the invalid field
        console.log(selector);
    }
},scopeId);

var validity = {
  nameoncard: 0,
  ccnumber: 0,
  ccExpMonth: 0,  
  ccExpYear: 0,
  cvv2: 0
}

var cvvEmptyState = true;

PaymentSession.onEmptinessChange(["card.securityCode"], function(selector, result) {
    //handle change event
    if (result.isEmpty) {
        // field has empty value
        cvvEmptyState = true;
        console.log("Element with selector " + selector + " has changed it's emptiness status to empty");
    } else if (!result.isEmpty) {
        // field has non-empty value
        cvvEmptyState = false;
        console.log("Element with selector " + selector + " has changed it's emptiness status to non-empty");
    }
});

PaymentSession.onValidityChange(["card.number", "card.nameOnCard", "card.expiryMonth", "card.expiryYear", "card.securityCode"], function(selector, result) {
  console.log("here is the selector: " + selector);
console.log("here is the result: " + JSON.stringify(result));
  var selector = selector.substring(1);
  var ccnumberDiv = document.getElementById("ccnumber-border");
    var validityState = "is-invalid";
    if (result.isValid) {
        //handle valid results
        console.log('The entered value is valid.');
        // set a state to valid

        validityState = "is-valid";

  
    } 


    switch (selector) {
            case "nameoncard":
            document.getElementById(selector).classList.remove("is-invalid");
            document.getElementById(selector).classList.remove("is-valid");
            document.getElementById(selector).classList.add(validityState);
                break;
            case "ccnumber":
            ccnumberDiv.classList.remove("is-invalid");
            ccnumberDiv.classList.remove("valid");
            ccnumberDiv.classList.add(validityState);
                break;
                case "ccExpMonth":
            document.getElementById(selector).classList.remove("is-invalid");
            document.getElementById(selector).classList.remove("is-valid");
            document.getElementById(selector).classList.add(validityState);
                break;
                case "ccExpYear":
                document.getElementById(selector).classList.remove("is-invalid");
            document.getElementById(selector).classList.remove("is-valid");
            document.getElementById(selector).classList.add(validityState);
                break;
                case "cvv2":
              
                document.getElementById(selector).classList.remove("is-invalid");
            document.getElementById(selector).classList.remove("is-valid");
              if (cvvEmptyState == false){

            
                
            document.getElementById(selector).classList.add(validityState);

          }
                break;
        }

  
  if (result.isValid) {
        //handle valid results
        console.log('The entered value is valid.');
    validity[selector]=1;
    console.log("card validity check : " + JSON.stringify(validity));
    var total = 0;
    
    
    for(var item in validity) {
      total = total + validity[item];
  console.log("total: " + total);
}
if (total == 5){
  document.getElementById("payment-button").removeAttribute("disabled");
}

    } else {
        //handle invalid results
        if (result.isIncomplete) {
            console.log('Field value is incomplete, please enter full value.');
        }
        }

},scopeId);

PaymentSession.onCardTypeChange(function(selector, result, scopeId) {
  var cardTypeDiv = document.getElementById("card-type");
    //handle change event
    if (result.status === 'SUPPORTED') {
      //$(ccnumber).switchClass( "invalid", "valid");
      
        //display card scheme based on result
        switch (result.brand) {
            case "VISA":
            cardTypeDiv.setAttribute("class", "visa");
                break;
            case "MASTERCARD":
            cardTypeDiv.setAttribute("class", "mastercard");
                break;
            case "AMEX":
            cardTypeDiv.setAttribute("class", "amex");
            document.getElementById("cvv2").setAttribute("placeholder", "••••");
            console.log("scopeId = " + scopeId);
            PaymentSession.setFocus('card.securityCode', scopeId);

            PaymentSession.setPlaceholderShownStyle(['card.securityCode'], {
              color: 'green',
              fontWeight: 'bold',
              textDecoration: 'underline'
}, scopeId);
                break;
        }
        

    } else {
            
    	if (result.status === 'INSUFFICIENT_LENGTH') {
        // selector for invalid field is provided
        console.log('Minimum of 10 digits required to determine card type.');
       
    	}
    	if (result.status === 'NOT_SUPPORTED') {
        console.log('The card type you entered is not supported.');

    	}
    
    }
});
scopeId == scopeId + 1;
});

function extraCvvCallback(result){
  console.log("extra CVV callback fired, result: " + JSON.stringify(result));
}

function updateSession() {
// UPDATE THE SESSION WITH THE INPUT FROM HOSTED FIELDS
PaymentSession.updateSessionFromForm('card', undefined);
}





      });

      try {
        App.restore();
      } catch (err) {
        App.load('home');
      } 
    </script>
  </body>
</html>
